{% extends "base.html" %}

{% block title %}Nuevo M√©todo de Pago - Sistema de Inventario{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">‚ûï Nuevo M√©todo de Pago</h4>
                <a href="{{ url_for('venta.metodos_pago', id_empresa=id_empresa) }}" class="btn btn-outline-light btn-sm">
                    üí≥ Ver M√©todos
                </a>
            </div>
            
            <div class="card-body">
                <form method="POST">
                    {{ form.hidden_tag() }}

                    <!-- Nombre del m√©todo -->
                    <div class="mb-3">
                        {{ form.nombre.label(class="form-label") }}
                        {{ form.nombre(class="form-control" + (" is-invalid" if form.nombre.errors else "")) }}
                        {% if form.nombre.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.nombre.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="text-info">üí° Ej: PayPal, Bitcoin, Cheque, Cr√©dito Empresarial</i>
                        </div>
                    </div>

                    <!-- Descripci√≥n -->
                    <div class="mb-3">
                        {{ form.descripcion.label(class="form-label") }}
                        {{ form.descripcion(class="form-control" + (" is-invalid" if form.descripcion.errors else "")) }}
                        {% if form.descripcion.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.descripcion.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="text-muted">Opcional - Describe las caracter√≠sticas o condiciones del m√©todo</i>
                        </div>
                    </div>

                    <!-- Estado activo -->
                    <div class="mb-3">
                        <div class="form-check">
                            {{ form.activo(class="form-check-input") }}
                            {{ form.activo.label(class="form-check-label") }}
                        </div>
                        <div class="form-text">
                            <i class="text-info">Solo los m√©todos activos aparecen en el punto de venta</i>
                        </div>
                    </div>

                    <!-- Vista previa -->
                    <div class="card bg-light mb-3" id="vistaPrevia" style="display: none;">
                        <div class="card-header">
                            <h6 class="mb-0">üëÅÔ∏è Vista Previa</h6>
                        </div>
                        <div class="card-body">
                            <p><strong>As√≠ se ver√° en el punto de venta:</strong></p>
                            <button type="button" class="btn btn-outline-primary" id="botonPreview">
                                <span id="nombrePreview">M√©todo de Pago</span>
                            </button>
                            <div class="mt-2">
                                <small class="text-muted" id="descripcionPreview"></small>
                            </div>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('venta.metodos_pago', id_empresa=id_empresa) }}" class="btn btn-secondary">
                            ‚Üê Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            üíæ Crear M√©todo
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Ejemplos y consejos -->
        <div class="card mt-4 border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">üí° Ejemplos de M√©todos Personalizados</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-success">‚úÖ Buenos ejemplos:</h6>
                        <ul class="small">
                            <li><strong>üí∞ Cr√©dito Empresarial</strong><br>
                                <em>Para clientes con cuenta corriente</em>
                            </li>
                            <li><strong>üè¶ Cheque</strong><br>
                                <em>Pago con cheque bancario</em>
                            </li>
                            <li><strong>‚Çø Criptomonedas</strong><br>
                                <em>Bitcoin, Ethereum, etc.</em>
                            </li>
                            <li><strong>üì± Daviplata</strong><br>
                                <em>Billetera digital</em>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-warning">‚ö†Ô∏è Consideraciones:</h6>
                        <ul class="small">
                            <li>Usa nombres claros y espec√≠ficos</li>
                            <li>Agrega emojis para mejor identificaci√≥n</li>
                            <li>Incluye condiciones en la descripci√≥n</li>
                            <li>Desactiva m√©todos temporalmente no disponibles</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√©todos existentes -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">üìã M√©todos Actuales</h6>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-2">M√©todos de pago ya configurados:</p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-success">üíµ Efectivo</span>
                    <span class="badge bg-primary">üí≥ Tarjeta de D√©bito</span>
                    <span class="badge bg-primary">üí≥ Tarjeta de Cr√©dito</span>
                    <span class="badge bg-info">üì± Transferencia</span>
                    <span class="badge bg-info">üì± PSE</span>
                    <span class="badge bg-secondary">üè¶ Consignaci√≥n</span>
                </div>
                <p class="small text-muted mt-2 mb-0">
                    Los m√©todos b√°sicos no se pueden eliminar, solo activar/desactivar.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Vista previa en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const nombreInput = document.getElementById('nombre');
    const descripcionInput = document.getElementById('descripcion');
    const activoInput = document.getElementById('activo');
    const vistaPrevia = document.getElementById('vistaPrevia');
    const nombrePreview = document.getElementById('nombrePreview');
    const descripcionPreview = document.getElementById('descripcionPreview');
    const botonPreview = document.getElementById('botonPreview');

    function actualizarVistaPrevia() {
        const nombre = nombreInput.value.trim();
        const descripcion = descripcionInput.value.trim();
        const activo = activoInput.checked;

        if (nombre) {
            vistaPrevia.style.display = 'block';
            nombrePreview.textContent = nombre;
            descripcionPreview.textContent = descripcion || 'Sin descripci√≥n';
            
            // Cambiar estilo del bot√≥n seg√∫n estado
            if (activo) {
                botonPreview.className = 'btn btn-outline-primary';
                botonPreview.style.opacity = '1';
            } else {
                botonPreview.className = 'btn btn-outline-secondary';
                botonPreview.style.opacity = '0.6';
            }
        } else {
            vistaPrevia.style.display = 'none';
        }
    }

    // Escuchar cambios en los inputs
    nombreInput.addEventListener('input', actualizarVistaPrevia);
    descripcionInput.addEventListener('input', actualizarVistaPrevia);
    activoInput.addEventListener('change', actualizarVistaPrevia);

    // Vista previa inicial
    actualizarVistaPrevia();

    // Sugerencias de nombres con emojis
    const sugerencias = [
        'üí∞ Cr√©dito Empresarial',
        'üè¶ Cheque',
        '‚Çø Criptomonedas',
        'üì± Daviplata',
        'üì± Nequi',
        'üé´ Bonos de Regalo',
        'üí≥ Tarjeta Regalo',
        'ü§ù Trueque',
        'üìÑ Factura a Cr√©dito'
    ];

    nombreInput.addEventListener('focus', function() {
        if (!this.value) {
            const sugerencia = sugerencias[Math.floor(Math.random() * sugerencias.length)];
            this.placeholder = `Ej: ${sugerencia}`;
        }
    });

    // Validaci√≥n en tiempo real
    nombreInput.addEventListener('input', function() {
        const valor = this.value.trim();
        const feedback = this.nextElementSibling;
        
        if (valor.length > 0 && valor.length < 2) {
            this.classList.add('is-invalid');
            if (feedback && feedback.classList.contains('invalid-feedback')) {
                feedback.textContent = 'El nombre debe tener al menos 2 caracteres';
            }
        } else {
            this.classList.remove('is-invalid');
        }
    });
});
</script>
{% endblock %}